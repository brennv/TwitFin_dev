---
- name: Build Docker images from Dockerfiles.
  docker_image:
    name: "{{ item.name }}"
    tag: "{{ item.tag }}"
    path: "/vagrant/{{ item.directory }}"
    state: build

  with_items:
    # - { name: data, tag: "data", directory: data }
    - { name: app, tag: "flask", directory: app }
    # - { name: db, tag: mysql, directory: db }

# Data containers don't need to be running to be utilized.
# - name: Run a Data container.
#   docker:
#     image: data:data
#     name: data
#     state: present

- name: Run a Flask container.
  docker:
    image: app:flask
    name: app
    # volumes: /vagrant/app:/etc/ansible
    state: running
    command: jupyter notebook
    ports: "80:80"

# - name: Run a MySQL container.
#   docker:
#     image: db:mysql
#     name: db
#     state: running
#     volumes_from: data
#     command: /opt/start-mysql.sh
#     ports: "3306:3306"
